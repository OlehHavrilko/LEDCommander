# Информация о драйверах

## Поддерживаемые протоколы

### ✅ ELK-BLEDOM
- **Статус**: Полностью реализован и протестирован
- **UUID**: `0000fff3-0000-1000-8000-00805f9b34fb`
- **Формат**: `[0x7E, 0x07, 0x05, CMD, P1, P2, P3, SPEED, 0xEF]`
- **Определение**: По имени ("ELK", "BLEDOM") или UUID

### ✅ Triones
- **Статус**: Базовая реализация (может потребовать доработки)
- **UUID**: `0000ffd9-0000-1000-8000-00805f9b34fb` (основной)
- **Альтернативный UUID**: `0000ffd5-0000-1000-8000-00805f9b34fb`
- **Формат**: `[0x56, 0xAA, CMD, P1, P2, P3, 0xAA, 0xAA]`
- **Определение**: По имени ("TRIONES", "TRION") или UUID (ffd9, ffd5)

### ✅ MagicHome
- **Статус**: Базовая реализация (может потребовать доработки)
- **UUID**: `0000ffe5-0000-1000-8000-00805f9b34fb` (основной)
- **Альтернативный UUID**: `0000ffe9-0000-1000-8000-00805f9b34fb`
- **Формат**: `[0x7E, LEN, CMD, DATA..., 0xEF]`
- **Определение**: По имени ("MAGIC", "MAGICHOME", "MH-") или UUID (ffe5, ffe9)

### ✅ Tuya
- **Статус**: Базовая реализация (может потребовать доработки)
- **UUID**: `0000fe95-0000-1000-8000-00805f9b34fb` (основной)
- **Альтернативный UUID**: `0000fe40-0000-1000-8000-00805f9b34fb`
- **Формат**: `[CMD, LEN, DATA...]` (упрощенный, без шифрования)
- **Определение**: По имени ("TUYA", "TY-", "SMART LIFE") или UUID (fe95, fe40)

## Важные замечания

### Triones
- Протокол имеет несколько вариантов
- Некоторые устройства могут использовать другие UUID
- Драйвер автоматически пробует альтернативный UUID при ошибке

### MagicHome
- Существует множество моделей с разными протоколами
- Некоторые устройства используют Wi-Fi вместо BLE
- Текущая реализация для BLE-вариантов

### Tuya
- Протокол Tuya сложный и может использовать шифрование
- Некоторые устройства требуют аутентификации
- Текущая реализация поддерживает простые незашифрованные команды
- Для полной поддержки может потребоваться Tuya SDK

## Автоматическое определение

Система определяет протокол в следующем порядке:
1. **Triones** - проверяется первым (более специфичные UUID)
2. **MagicHome** - затем
3. **Tuya** - затем
4. **ELK-BLEDOM** - как fallback (самый распространенный)

## Настройка протокола

### Явное указание в конфиге

```json
{
  "device": {
    "target_mac": "FF:FF:10:69:5B:2A",
    "protocol": "triones"
  }
}
```

### Автоматическое определение

```json
{
  "device": {
    "target_mac": "FF:FF:10:69:5B:2A",
    "protocol": null
  }
}
```

## Отладка

Если устройство не определяется автоматически:

1. Используйте **nRF Connect** для сканирования устройства
2. Найдите UUID характеристик записи
3. Проверьте имя устройства
4. Укажите протокол явно в конфиге
5. Если UUID отличается от стандартных, может потребоваться доработка драйвера

## Доработка драйверов

Если ваше устройство не работает с базовой реализацией:

1. Определите точный UUID через nRF Connect
2. Проанализируйте формат пакетов (можно использовать BLE sniffer)
3. Обновите соответствующий драйвер:
   - Измените UUID в классе драйвера
   - Обновите метод `_build_packet()` если формат отличается
   - Добавьте специфичные команды если нужно

## Совместимость режимов

Все драйверы маппят общие режимы на свои внутренние:

- `MANUAL` → STATIC/MANUAL режим
- `CPU` → FADE режим (аппроксимация)
- `BREATH` → FADE режим
- `RAINBOW` → JUMP режим (аппроксимация)

Некоторые режимы могут работать по-разному на разных протоколах.

